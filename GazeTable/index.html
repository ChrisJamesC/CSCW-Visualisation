<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>The Gaze table</title>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.v2.js"></script>
    <script type="text/javascript" src="http://underscorejs.org/underscore.js"></script>
</head>
<body>
<script>
d3.csv("data/Week 2/Parrot/Parrot_EnergyTask_Part2.csv", function(rows) {
    var count = {
        s0:{tool:0, wb:0, s0:0, s1:0, s2:0, s3:0},
        s1:{tool:0, wb:0, s0:0, s1:0, s2:0, s3:0},
        s2:{tool:0, wb:0, s0:0, s1:0, s2:0, s3:0},
        s3:{tool:0, wb:0, s0:0, s1:0, s2:0, s3:0}
    }
    rows.forEach(function(row){
        count[row.subject][row.target] = count[row.subject][row.target] + parseFloat(row.time)
    })

    var img_width = 800;
    var img_height = 600;

    var tool_w = 32;
    var tool_h = 50;
    var positions = [
        {id:"s0", head:{x:0.78*img_width, y:0.455*img_height}, tool:{x:0.617*img_width, y:0.485*img_height}, color:"green"},
        {id:"s1", head:{x:0.74*img_width, y:0.150*img_height}, tool:{x:0.580*img_width, y:0.250*img_height}, color:"blue"},
        {id:"s2",head:{x:0.27*img_width, y:0.150*img_height}, tool:{x:0.368*img_width, y:0.248*img_height}, color:"red"},
        {id:"s3", head:{x:0.20*img_width, y:0.450*img_height}, tool:{x:0.335*img_width, y:0.500*img_height}, color:"orange"}
    ];

    var screen = {x: 0.12*img_width, y:0.88* img_height, width:img_width*3/4, height:30}

    var margin = {top: 20, right: 20, bottom: 30, left: 40},
        width = 960 - margin.left - margin.right,
        height = 700 - margin.top - margin.bottom;

    var x = d3.scale.linear()
        .range([0, width]);

    var y = d3.scale.linear()
        .range([height, 0]);

    var svg = d3.select("body").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom);

    var image = svg.append("image")
        .attr("xlink:href", "display-experimentCSCW-tableOnly.jpg")
        .attr("width", img_width)
        .attr("height", img_height);

    /* Define Gradient */

    defs = svg.append("svg:defs");

    var gradientB_G = defs.append("svg:linearGradient")
        .attr("id", "gradientB_G")

    gradientB_G.append("svg:stop")
        .attr("offset", "35%")
        .attr("stop-color", "#0000FF")

    gradientB_G.append("svg:stop")
        .attr("offset", "95%")
        .attr("stop-color", "#006400");

    var gradientR_G = defs.append("svg:linearGradient")
        .attr("id", "gradientR_G")

    gradientR_G.append("svg:stop")
        .attr("offset", "70%")
        .attr("stop-color", "#FF0000")

    gradientR_G.append("svg:stop")
        .attr("offset", "95%")
        .attr("stop-color", "#006400");

    var gradientY_G = defs.append("svg:linearGradient")
        .attr("id", "gradientY_G")

    gradientY_G.append("svg:stop")
        .attr("offset", "20%")
        .attr("stop-color", "#FFA500")

    gradientY_G.append("svg:stop")
        .attr("offset", "95%")
        .attr("stop-color", "#006400");

    var gradientY_B = defs.append("svg:linearGradient")
        .attr("id", "gradientY_B")

    gradientY_B.append("svg:stop")
        .attr("offset", "30%")
        .attr("stop-color", "#FFA500")

    gradientY_B.append("svg:stop")
        .attr("offset", "75%")
        .attr("stop-color", "#0000FF");

    var gradientY_R = defs.append("svg:linearGradient")
        .attr("id", "gradientY_R")

    gradientY_R.append("svg:stop")
        .attr("offset", "30%")
        .attr("stop-color", "#FFA500")

    gradientY_R.append("svg:stop")
        .attr("offset", "75%")
        .attr("stop-color", "#FF0000");



    var gradientR_B = defs.append("svg:linearGradient")
        .attr("id", "gradientR_B")

    gradientR_B.append("svg:stop")
        .attr("offset", "30%")
        .attr("stop-color", "#FFA500")

    gradientR_B.append("svg:stop")
        .attr("offset", "75%")
        .attr("stop-color", "#0000FF");

    /* Draw relations between characters */
    // 0->1
    svg.append("path")
        .attr("d", "M"+positions[0].head.x+","+ positions[0].head.y +" L" + positions[1].head.x + "," + positions[1].head.y)
        .attr("stroke-width", 15)
        .style("stroke", "url(#gradientB_G)");

    // 0->2
    svg.append("path")
        .attr("d", "M"+positions[0].head.x+","+ positions[0].head.y +" L" + positions[2].head.x + "," + positions[2].head.y)
        .attr("stroke-width", 10)
        .style("stroke", "url(#gradientR_G)");

    // 0->3
    svg.append("path")
        .attr("d", "M"+positions[0].head.x+","+ positions[0].head.y +" L" + positions[3].head.x + "," + positions[3].head.y)
        .attr("stroke-width", 10)
        .style("stroke", "url(#gradientY_G)");


    // 1->2
    svg.append("path")
        .attr("d", "M"+positions[1].head.x+","+ positions[1].head.y +" L" + positions[2].head.x + "," + positions[2].head.y)
        .attr("stroke", "black")
        .attr("stroke-width", 15)
        //.style("stroke", "url(#gradientR_B)");


    //1->3
    svg.append("path")
        .attr("d", "M"+positions[1].head.x+","+ positions[1].head.y +" L" + positions[3].head.x + "," + positions[3].head.y)
        .attr("stroke-width", 15)
        .style("stroke", "url(#gradientY_B)");

    //2->3
    svg.append("path")
        .attr("d", "M"+positions[2].head.x+","+ positions[2].head.y +" L" + positions[3].head.x + "," + positions[3].head.y)
        .attr("stroke-width", 15)
        .style("stroke", "url(#gradientY_R)");


    /* Draw relations to tool */
    // -----------------------
    svg.append("path")
        .attr("d", "M"+positions[0].head.x+","+ positions[0].head.y +" L" + (positions[0].tool.x+tool_w/2) + "," + (positions[0].tool.y+tool_h/2))
        .attr("stroke", "green")
        .attr("stroke-width", 10)


    svg.append("path")
        .attr("d", "M"+positions[1].head.x+","+ positions[1].head.y +" L" + (positions[1].tool.x+tool_w/2) + "," + (positions[1].tool.y+tool_h/2))
        .attr("stroke", "blue")
        .attr("stroke-width", 15)

    svg.append("path")
        .attr("d", "M"+positions[2].head.x+","+ positions[2].head.y +" L" + (positions[2].tool.x+tool_w/2) + "," + (positions[2].tool.y+tool_h/2))
        .attr("stroke", "red")
        .attr("stroke-width", 10)

    svg.append("path")
        .attr("d", "M"+positions[3].head.x+","+ positions[3].head.y +" L" + (positions[3].tool.x+tool_w/2) + "," + (positions[3].tool.y+tool_h/2))
        .attr("stroke", "orange")
        .attr("stroke-width", 5)


    /*
     positions.forEach(function(pos){
     svg.append("path")
     .attr("d", "M"+pos.head.x+","+ pos.head.y +" L" + (pos.tool.x+tool_w/2) + "," + (pos.tool.y+tool_h/2))
     //.attr("fill","red")
     .attr("stroke", "red")
     .attr("stroke-width", 10)
     })
     */

    /* Draw relations to Screen */


    positions.forEach(function(pos){
        svg.append("path")
            .attr("d", "M"+pos.head.x+","+ pos.head.y +" L" + (screen.x+screen.width/2) + "," + (screen.y+screen.height/2))
            //.attr("fill","red")
            .attr("stroke", "red")
            .attr("stroke-width", 2)
    })


    svg.append("path")
        .attr("d", "M"+positions[0].head.x+","+ positions[0].head.y +" L" + (screen.x+screen.width/2) + "," + (screen.y+screen.height/2))
        .attr("stroke", "green")
        .attr("stroke-width", 5)

    svg.append("path")
        .attr("d", "M"+positions[1].head.x+","+ positions[1].head.y +" L" + (screen.x+screen.width/2) + "," + (screen.y+screen.height/2))
        .attr("stroke", "blue")
        .attr("stroke-width", 10)

    svg.append("path")
        .attr("d", "M"+positions[2].head.x+","+ positions[2].head.y +" L" + (screen.x+screen.width/2) + "," + (screen.y+screen.height/2))
        .attr("stroke", "red")
        .attr("stroke-width", 10)

    svg.append("path")
        .attr("d", "M"+positions[3].head.x+","+ positions[3].head.y +" L" + (screen.x+screen.width/2) + "," + (screen.y+screen.height/2))
        .attr("stroke", "orange")
        .attr("stroke-width", 15)


    /* Draw heads */
    positions.forEach(function(pos){
        svg.append("circle")
            .attr("stroke",pos.color)
            .attr("stroke-width", "6px")
            .attr("fill", "SeaShell")
            .attr("r", "30px")
            .attr("cx", pos.head.x)
            .attr("cy", pos.head.y)
    });

    /* Draw tools */
    positions.forEach(function(pos){
        svg.append("rect")
            //.attr("class", "tool")
            .attr("stroke-width", "4px")
            .attr("stroke", pos.color)
            .attr("fill", "DarkGray")
            .attr("width", tool_w)
            .attr("height", tool_h)
            .attr("x", pos.tool.x)
            .attr("y", pos.tool.y)
    });

    /* Draw screen */
    svg.append("rect")
        .attr("stroke", "black")
        .attr("stroke-width", "4px")
        .attr("fill", "Silver")
        .attr("width",  screen.width)
        .attr("height", screen.height)
        .attr("borderStyle", "plain")
        .attr("x", screen.x)
        .attr("y", screen.y);
})

</script>
</body>
</html>
