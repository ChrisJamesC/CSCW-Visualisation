<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>The Gaze table</title>
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.v2.js"></script>
    <script type="text/javascript" src="http://underscorejs.org/underscore.js"></script>
  </head>
  <body>
  <script>
    d3.csv("data/Week 2/Parrot/Parrot_EnergyTask_Part2.csv", function(rows) {
      var count = {
          s0:{tool:0, wb:0, s0:0, s1:0, s2:0, s3:0},
          s1:{tool:0, wb:0, s0:0, s1:0, s2:0, s3:0},
          s2:{tool:0, wb:0, s0:0, s1:0, s2:0, s3:0},
          s3:{tool:0, wb:0, s0:0, s1:0, s2:0, s3:0}
      }
      rows.forEach(function(row){
        count[row.subject][row.target] = count[row.subject][row.target] + parseFloat(row.time)
      })

      var img_width = 800;
      var img_height = 600;

      var tool_w = 42;
      var tool_h = 60;
      var positions = [
          {id:"s0", head:{x:0.76*img_width, y:0.455*img_height}, tool:{x:0.617*img_width, y:0.475*img_height}, color:"green"},
          {id:"s1", head:{x:0.74*img_width, y:0.220*img_height}, tool:{x:0.580*img_width, y:0.210*img_height}, color:"blue"},
          {id:"s2",head:{x:0.27*img_width, y:0.220*img_height}, tool:{x:0.365*img_width, y:0.210*img_height}, color:"red"},
          {id:"s4", head:{x:0.25*img_width, y:0.450*img_height}, tool:{x:0.335*img_width, y:0.475*img_height}, color:"orange"}
      ];

      var screen = {x: 0.12*img_width, y:0.88* img_height, width:img_width*3/4, height:30}

      var margin = {top: 20, right: 20, bottom: 30, left: 40},
          width = 960 - margin.left - margin.right,
          height = 700 - margin.top - margin.bottom;

      var x = d3.scale.linear()
          .range([0, width]);

      var y = d3.scale.linear()
          .range([height, 0]);

      var svg = d3.select("body").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom);

      var image = svg.append("image")
          .attr("xlink:href", "display-experimentCSCW-tableOnly.jpg")
          .attr("width", img_width)
          .attr("height", img_height);

      /* Draw relations between characters */
      // 0->1
      svg.append("path")
          .attr("d", "M"+positions[0].head.x+","+ positions[0].head.y +" L" + positions[1].head.x + "," + positions[1].head.y)
          .attr("stroke", "yellow")
          .attr("stroke-width", 5)

      //0->2
      svg.append("path")
          .attr("d", "M"+positions[0].head.x+","+ positions[0].head.y +" L" + positions[2].head.x + "," + positions[2].head.y)
          .attr("stroke", "yellow")
          .attr("stroke-width", 5)

      //0->3
      svg.append("path")
          .attr("d", "M"+positions[0].head.x+","+ positions[0].head.y +" L" + positions[3].head.x + "," + positions[3].head.y)
          .attr("stroke", "yellow")
          .attr("stroke-width", 5)

      //1->2
      svg.append("path")
          .attr("d", "M"+positions[1].head.x+","+ positions[1].head.y +" L" + positions[2].head.x + "," + positions[2].head.y)
          .attr("stroke", "yellow")
          .attr("stroke-width", 5)

      //1->3
      svg.append("path")
          .attr("d", "M"+positions[1].head.x+","+ positions[1].head.y +" L" + positions[3].head.x + "," + positions[3].head.y)
          .attr("stroke", "yellow")
          .attr("stroke-width", 5)

      //2->3
      svg.append("path")
          .attr("d", "M"+positions[2].head.x+","+ positions[2].head.y +" L" + positions[3].head.x + "," + positions[3].head.y)
          .attr("stroke", "yellow")
          .attr("stroke-width", 5)

      /* Draw relations to tool */
      positions.forEach(function(pos){
          svg.append("path")
            .attr("d", "M"+pos.head.x+","+ pos.head.y +" L" + (pos.tool.x+tool_w/2) + "," + (pos.tool.y+tool_h/2))
            //.attr("fill","red")
            .attr("stroke", "green")
            .attr("stroke-width", 10)
      })

      /* Draw relations to Screen */
      positions.forEach(function(pos){
          svg.append("path")
              .attr("d", "M"+pos.head.x+","+ pos.head.y +" L" + (screen.x+screen.width/2) + "," + (screen.y+screen.height/2))
              //.attr("fill","red")
              .attr("stroke", "red")
              .attr("stroke-width", 2)
      })

      /* Draw heads */
      positions.forEach(function(pos){
          svg.append("circle")
              .attr("stroke",pos.color)
              .attr("stroke-width", "6px")
              .attr("fill", "white")
              .attr("r", "30px")
              .attr("cx", pos.head.x)
              .attr("cy", pos.head.y)
      });

      /* Draw tools */
      positions.forEach(function(pos){
          svg.append("rect")
              //.attr("class", "tool")
              .attr("stroke-width", "4px")
              .attr("stroke", pos.color)
              .attr("fill", "white")
              .attr("width", tool_w)
              .attr("height", tool_h)
              .attr("x", pos.tool.x)
              .attr("y", pos.tool.y)
      });

      /* Draw screen */
      svg.append("rect")
          .attr("stroke", "black")
          .attr("stroke-width", "4px")
          .attr("fill", "white")
          .attr("width",  screen.width)
          .attr("height", screen.height)
          .attr("borderStyle", "plain")
          .attr("x", screen.x)
          .attr("y", screen.y);
    })

  </script>
  </body>
</html>
